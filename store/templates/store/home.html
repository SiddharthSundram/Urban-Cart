{% extends 'store/base.html' %}

{% block content %}

<h1 class="text-3xl font-bold text-center mb-8">UrbanCart Products</h1>

{% if request.GET %}
<div class="mb-4 text-sm text-gray-600 bg-gray-100 p-3 rounded border">
    <strong>Filters:</strong>

    {% if request.GET.q %}
        <span class="mr-4">
            üîç Search: "{{ request.GET.q }}"
        </span>
    {% endif %}

    {% if request.GET.category %}
        <span class="mr-4">
            üè∑Ô∏è Category ID: {{ request.GET.category }}
        </span>
    {% endif %}

    {% if request.GET.min or request.GET.max %}
        <span class="mr-4">
            üí∞ Price:
            {% if request.GET.min %}‚Çπ{{ request.GET.min }}{% endif %}
            -
            {% if request.GET.max %}‚Çπ{{ request.GET.max }}{% endif %}
        </span>
    {% endif %}

    {% if request.GET.sort %}
        <span class="mr-4">
            üìå Sort: {{ request.GET.sort }}
        </span>
    {% endif %}
</div>
{% endif %}


<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">

    {% if products|length == 0 %}
        <p class="text-center text-gray-600 mt-6 col-span-full">No products found.</p>
    {% endif %}

    {% for p in products %}
        <div class="bg-white shadow-lg rounded-lg overflow-hidden">

            <img src="{{ p.image.url }}" class="w-full h-48 object-cover">

            <div class="p-4">

                {% if p.category %}
                    <span class="inline-block bg-gray-200 text-gray-700 text-xs px-2 py-1 rounded mb-2">
                        {{ p.category.name }}
                    </span>
                {% endif %}

                <h2 class="text-lg font-semibold">{{ p.name }}</h2>
                <p class="text-gray-600 font-medium mt-1">‚Çπ{{ p.price }}</p>

                <a href="{% url 'product_detail' p.id %}">
                    <button class="mt-3 w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition">
                        Buy Now
                    </button>
                </a>

            </div>
        </div>
    {% endfor %}

</div>


<!-- Pagination -->
<div class="flex justify-center space-x-3 mt-8">

    {% if products.has_previous %}
        <a href="?page={{ products.previous_page_number }}&q={{ request.GET.q }}&category={{ request.GET.category }}&min={{ request.GET.min }}&max={{ request.GET.max }}&sort={{ request.GET.sort }}" 
           class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">
            Prev
        </a>
    {% endif %}

    <span class="px-4 py-1 bg-blue-600 text-white rounded">
        {{ products.number }} / {{ products.paginator.num_pages }}
    </span>

    {% if products.has_next %}
        <a href="?page={{ products.next_page_number }}&q={{ request.GET.q }}&category={{ request.GET.category }}&min={{ request.GET.min }}&max={{ request.GET.max }}&sort={{ request.GET.sort }}" 
           class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">
            Next
        </a>
    {% endif %}

</div>

{% endblock %}
