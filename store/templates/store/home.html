{% extends 'store/base.html' %}

{% block content %}

<style>
    /* Thin, sleek scrollbar */
    .custom-scrollbar::-webkit-scrollbar {
        width: 5px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
    }
</style>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
        <div>
            <h1 class="text-3xl font-bold text-slate-900 tracking-tight">
                {% if q %}Results for "<span class="text-indigo-600">{{ q }}</span>"{% else %}Discover Products{% endif %}
            </h1>
            <p class="text-slate-500 mt-1">Showing {{ products|length }} items</p>
        </div>

        <button onclick="document.getElementById('sidebarFilters').classList.toggle('hidden')" 
                class="md:hidden flex items-center justify-center gap-2 bg-white border border-slate-300 px-5 py-2.5 rounded-full font-medium text-slate-700 shadow-sm hover:bg-slate-50">
            <i class="fas fa-sliders-h"></i> Filters
        </button>
    </div>

    <div class="flex flex-col md:flex-row gap-8 items-start relative">

        <aside id="sidebarFilters" 
               class="hidden md:block w-full md:w-72 flex-shrink-0 sticky top-24 max-h-[85vh] overflow-y-auto custom-scrollbar rounded-2xl">
            
            <form method="get" class="bg-white p-6 shadow-sm border border-slate-200 rounded-2xl">
                
                {% if q %} <input type="hidden" name="q" value="{{ q }}"> {% endif %}

                <div class="flex justify-between items-center mb-6 sticky top-0 bg-white z-10 pb-2 border-b border-transparent">
                    <h2 class="font-bold text-slate-800 text-lg">Filters</h2>
                    <a href="{% url 'home' %}" class="text-xs font-semibold text-indigo-600 hover:text-indigo-800 uppercase tracking-wide">Reset</a>
                </div>

                <div class="mb-8">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">Category</h3>
                    
                    <div class="space-y-3 max-h-60 overflow-y-auto custom-scrollbar pr-2">
                        
                        <label class="flex items-center gap-3 cursor-pointer group p-1 rounded hover:bg-slate-50 transition">
                            <div class="relative flex items-center">
                                <input type="radio" name="category" value="" 
                                       class="peer appearance-none w-5 h-5 border-2 border-slate-300 rounded-full checked:border-indigo-600 checked:border-4 transition-all"
                                       {% if not selected_category %}checked{% endif %}>
                            </div>
                            <span class="text-slate-600 font-medium text-sm peer-checked:text-indigo-700">All Categories</span>
                        </label>

                        {% for c in categories %}
                        <label class="flex items-center gap-3 cursor-pointer group p-1 rounded hover:bg-slate-50 transition">
                            <div class="relative flex items-center">
                                <input type="radio" name="category" value="{{ c.id }}" 
                                       class="peer appearance-none w-5 h-5 border-2 border-slate-300 rounded-full checked:border-indigo-600 checked:border-4 transition-all"
                                       {% if c.id|stringformat:'s' == selected_category %}checked{% endif %}>
                            </div>
                            <span class="text-slate-600 font-medium text-sm peer-checked:text-indigo-700">{{ c.name }}</span>
                        </label>
                        {% endfor %}
                    </div>
                </div>

                <div class="mb-8">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">Price Range</h3>
                    <div class="flex items-center gap-2">
                        <div class="relative w-full">
                            <span class="absolute left-3 top-2.5 text-slate-400 text-xs font-bold">₹</span>
                            <input type="number" name="min" value="{{ min_price }}" placeholder="0" 
                                   class="w-full pl-6 pr-3 py-2 text-sm font-medium bg-slate-50 border border-slate-200 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition">
                        </div>
                        <span class="text-slate-300">-</span>
                        <div class="relative w-full">
                            <span class="absolute left-3 top-2.5 text-slate-400 text-xs font-bold">₹</span>
                            <input type="number" name="max" value="{{ max_price }}" placeholder="Max" 
                                   class="w-full pl-6 pr-3 py-2 text-sm font-medium bg-slate-50 border border-slate-200 rounded-lg focus:bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition">
                        </div>
                    </div>
                </div>

                <div class="mb-8">
                    <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">Sort By</h3>
                    <div class="relative">
                        <select name="sort" class="w-full appearance-none bg-slate-50 border border-slate-200 text-slate-700 py-2.5 px-4 pr-8 rounded-lg leading-tight focus:outline-none focus:bg-white focus:border-indigo-500 text-sm font-medium cursor-pointer">
                            <option value="" {% if not sort %}selected{% endif %}>Recommended</option>
                            <option value="low" {% if sort == 'low' %}selected{% endif %}>Price: Low to High</option>
                            <option value="high" {% if sort == 'high' %}selected{% endif %}>Price: High to Low</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-500">
                            <i class="fas fa-chevron-down text-xs"></i>
                        </div>
                    </div>
                </div>

                <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-xl shadow-lg shadow-indigo-200 transition-all duration-200 transform hover:-translate-y-0.5 sticky bottom-0 z-10">
                    Apply Filters
                </button>
            </form>
        </aside>

        <main class="flex-1 w-full min-h-screen">
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                
                {% if products|length == 0 %}
                    <div class="col-span-full py-20 text-center">
                        <div class="inline-flex items-center justify-center w-20 h-20 bg-indigo-50 text-indigo-500 rounded-full mb-6">
                            <i class="fas fa-search text-3xl"></i>
                        </div>
                        <h3 class="text-xl font-bold text-slate-900">No matches found</h3>
                        <p class="text-slate-500 mt-2 max-w-sm mx-auto">We couldn't find any products matching your filters.</p>
                        <a href="{% url 'home' %}" class="mt-6 inline-block bg-white border border-slate-300 text-slate-700 font-medium px-6 py-2 rounded-lg hover:bg-slate-50 transition">
                            Clear Filters
                        </a>
                    </div>
                {% endif %}

                {% for p in products %}
                <div class="group relative bg-white rounded-2xl shadow-sm border border-slate-100 hover:shadow-2xl hover:shadow-indigo-100/50 transition-all duration-300 flex flex-col overflow-hidden">
                    
                    <div class="relative aspect-[4/3] overflow-hidden bg-slate-100">
                        {% if p.image %}
                            <img src="{{ p.image.url }}" alt="{{ p.name }}" 
                                 class="w-full h-full object-cover transform group-hover:scale-110 transition duration-700 ease-out">
                        {% else %}
                            <div class="w-full h-full flex items-center justify-center text-slate-300">
                                <i class="fas fa-image text-4xl"></i>
                            </div>
                        {% endif %}

                        <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center backdrop-blur-[2px]">
                            <a href="{% url 'product_detail' p.id %}" 
                               class="transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300 bg-white text-slate-900 font-bold py-2.5 px-6 rounded-full shadow-lg hover:bg-indigo-600 hover:text-white">
                                View Details
                            </a>
                        </div>

                        <div class="absolute top-3 left-3">
                            <span class="bg-white/90 backdrop-blur text-indigo-600 text-xs font-bold px-2.5 py-1 rounded-md shadow-sm">
                                {{ p.category.name }}
                            </span>
                        </div>
                    </div>

                    <div class="p-5 flex flex-col flex-1">
                        <h3 class="text-lg font-bold text-slate-800 mb-1 line-clamp-1 group-hover:text-indigo-600 transition-colors">
                            <a href="{% url 'product_detail' p.id %}">{{ p.name }}</a>
                        </h3>
                        
                        <div class="mt-auto pt-4 flex items-end justify-between">
                            <div>
                                <p class="text-xs text-slate-400 font-medium mb-0.5">Price</p>
                                <p class="text-xl font-extrabold text-slate-900">₹{{ p.price }}</p>
                            </div>
                            
                            <a href="{% url 'product_detail' p.id %}" class="w-10 h-10 rounded-full bg-slate-50 text-slate-600 flex items-center justify-center hover:bg-indigo-600 hover:text-white transition-colors shadow-sm">
                                <i class="fas fa-arrow-right"></i>
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}

            </div>

            {% if products.has_other_pages %}
            <div class="mt-16 flex justify-center pb-10">
                <nav class="inline-flex bg-white rounded-lg shadow-sm border border-slate-200 p-1">
                    {% if products.has_previous %}
                        <a href="?page={{ products.previous_page_number }}&q={{ q }}&category={{ selected_category }}&min={{ min_price }}&max={{ max_price }}&sort={{ sort }}" 
                           class="px-4 py-2 text-sm font-medium text-slate-600 rounded-md hover:bg-slate-50 transition">
                           Previous
                        </a>
                    {% endif %}

                    <span class="px-4 py-2 text-sm font-bold text-indigo-600 bg-indigo-50 rounded-md">
                        {{ products.number }}
                    </span>

                    {% if products.has_next %}
                        <a href="?page={{ products.next_page_number }}&q={{ q }}&category={{ selected_category }}&min={{ min_price }}&max={{ max_price }}&sort={{ sort }}" 
                           class="px-4 py-2 text-sm font-medium text-slate-600 rounded-md hover:bg-slate-50 transition">
                           Next
                        </a>
                    {% endif %}
                </nav>
            </div>
            {% endif %}

        </main>
    </div>
</div>

{% endblock %}